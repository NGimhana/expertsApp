<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Expert Instructions</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 40px;
      background-color: #f4f4f4;
      color: #333;
    }
    .instructions {
      background-color: #fff;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 20px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    button {
      padding: 12px 24px;
      font-size: 16px;
      border-radius: 6px;
      border: none;
      background-color: #4CAF50;
      color: white;
      cursor: pointer;
      box-shadow: 0 0 10px #4CAF50;
      animation: glowPulse 1.5s infinite alternate;
    }
    @keyframes glowPulse {
      0% { box-shadow: 0 0 10px #4CAF50; }
      100% { box-shadow: 0 0 20px #4CAF50, 0 0 30px #4CAF50; }
    }
    button:hover {
      background-color: #45a049;
    }
    a {
      color: #4CAF50;
      text-decoration: none;
    }
    a:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>

<div class="instructions">
  <h2>Welcome and Overview</h2>
  <p>Thank you for agreeing to contribute your expertise to this research study. Your input will help establish a reliable ground truth for code snippet comprehensibility, which is essential for evaluating and improving the proxies used to predict code comprehension. While prior research has often relied on undergraduate computer science students as stand-ins for professional developers, this study uses your expert judgments to evaluate the reliability of such proxies. Please carefully follow the instructions and protocol outlined below.</p>

    <p><strong>Please use a desktop or laptop computer (not a mobile device) to complete this study.</strong> The interface involves drag-and-drop interactions and viewing multiple code snippets side by side, which works best on a full screen.</p>

    <p>We also use cookies and session storage to save your progress locally between phases. If you prefer not to use cookies, you may complete the study in an incognito/private browsing window (note: this disables local saving).</p>

  <h3>Definitions</h3>
  <p><strong>What is Code Comprehensibility?</strong><br>
  In this study, we define code comprehensibility as the extent to which experienced developers perceive a code snippet to be easy to understand in terms of its functionality and purpose. There is no universally accepted definition, so your perspective as an expert is crucial.</p>

  <p><strong>What is a Code Snippet?</strong><br>
  A code snippet in this study, refers to a small, self-contained Java method sourced from real-world, high-quality repositories. Each snippet is independent of the others. There are a total of 8 code snippets in this study.</p>

  <h3>Study Design</h3>
  <p>Our goal is to develop an expert-determined ranking of code snippet comprehensibility. This ranking will serve as the ground truth for a larger study.</p>
  <p>To reduce bias and ensure validity, we invited multiple experts, including yourself, to complete the same tasks. We use a structured protocol based on the <a href="https://en.wikipedia.org/wiki/Delphi_method" target="_blank">Delphi method</a>, a technique designed to aggregate expert consensus through multiple rounds.</p>

  <p><strong>Protocol Overview:</strong></p>
  <ul>
    <li>You will complete two main tasks involving all 8 code snippets:
      <ul>
        <li><strong>Phase 1:</strong> Reading and Understanding All Code Snippets</li>
        <li><strong>Phase 2:</strong> Ranking the Code Snippets by Comprehensibility</li>
      </ul>
      Together, these phases should take no more than one hour in total.</li>
    <li>After all submissions are received, we will analyze the expert rankings.</li>
    <li>If unanimous agreement on the rankings is reached, the study will conclude.</li>
    <li>If not, we will initiate follow-up rounds and share anonymized feedback from other experts.</li>
    <li>You will have the opportunity to review and optionally revise your rankings based on this feedback.</li>
    <li>We may repeat this process for up to three rounds.</li>
    <li>If full consensus is still not reached, we will use statistical aggregation to produce the final ground truth.</li>
    <li>We may revise or replace certain snippets if experts report difficulties in distinguishing them based on comprehensibility.</li>
  </ul>

  <h3>Submission Deadline</h3>
  <p><strong>All responses must be submitted by <span style="color: #d32f2f;">May 20, 2025</span>.</strong><br>
  Please ensure you complete both phases by the deadline so your input can be included in the final analysis.</p>

  <h3>Next Step</h3>
<!-- Login Section -->
<form id="login-box" onsubmit="return loginAndProceed(event)" autocomplete="on">
  <h3>Login to Begin</h3>
  <p><strong>Please enter your username and password to start the study:</strong></p>

  <input type="text" id="username" name="username" placeholder="Username" autocomplete="username"
         style="padding: 8px; font-size: 16px; width: 300px; border-radius: 5px; border: 1px solid #ccc;"><br><br>

  <input type="password" id="password" name="password" placeholder="Password" autocomplete="current-password"
         style="padding: 8px; font-size: 16px; width: 300px; border-radius: 5px; border: 1px solid #ccc;"><br>

  <p id="login-error" style="color: red; display: none;"></p>

  <p style="margin-top: 20px;">
    <button type="submit">Login and Start Phase 1</button>
  </p>
</form>


<!-- Post-login Proceed Button -->
<div id="proceed-box" style="display: none; margin-top: 20px;">
  <p>Welcome back, <span id="participant-display-name" style="font-weight: bold;"></span>!</p>
  <button onclick="proceedToPhase1()">Proceed to Phase 1</button>
</div>


</div>


<footer style="margin-top: 40px; padding-top: 20px; border-top: 1px solid #ccc; text-align: center; font-size: 14px; color: #666;">
  Please contact us if you have any questions or issues: <a href="mailto:ea442@njit.edu">ea442@njit.edu</a>
</footer>


<script>
  function setCookie(name, value, days = 30) {
    const expires = new Date(Date.now() + days * 864e5).toUTCString();
    document.cookie = `${name}=${encodeURIComponent(value)}; path=/; expires=${expires}`;
  }
  
  async function loginAndProceed(event) {
  event.preventDefault();

  const username = document.getElementById('username').value.trim();
  const password = document.getElementById('password').value.trim();
  const errorDiv = document.getElementById('login-error');
  errorDiv.style.display = 'none';

  if (!username || !password) {
    errorDiv.textContent = "Please enter both username and password.";
    errorDiv.style.display = 'block';
    return;
  }

  try {
    const response = await fetch('https://codecomprehensibility.site/get_snippet_order', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ username, password })
    });

    if (!response.ok) throw new Error("Invalid credentials");

    const data = await response.json();
    const { participantName, snippetOrder } = data;

    if (!participantName || !snippetOrder) throw new Error("Incomplete response");

    sessionStorage.setItem('participantName', participantName);
    sessionStorage.setItem('snippetOrder', JSON.stringify(snippetOrder));
    sessionStorage.setItem('username', username);

    setCookie('participantName', participantName);
    setCookie('snippetOrder', JSON.stringify(snippetOrder));
    setCookie('username', username);

    window.location.href = 'phase1.html';

  } catch (err) {
    console.error(err);
    errorDiv.textContent = "Login failed. Please check your credentials.";
    errorDiv.style.display = 'block';
  }
}

  </script>
  

<script>
  function getCookie(name) {
    const match = document.cookie.match(new RegExp('(^| )' + name + '=([^;]+)'));
    return match ? decodeURIComponent(match[2]) : null;
  }

  function isLoggedIn() {
    const name = sessionStorage.getItem('participantName') || getCookie('participantName');
    const order = sessionStorage.getItem('snippetOrder') || getCookie('snippetOrder');
    return name && order;
  }

  window.onload = () => {
    if (isLoggedIn()) {
      const name = sessionStorage.getItem('participantName') || getCookie('participantName');
      document.getElementById('login-box').style.display = 'none';
      document.getElementById('proceed-box').style.display = 'block';
      document.getElementById('participant-display-name').textContent = name;
    }
  };

  function proceedToPhase1() {
    window.location.href = 'phase1.html';
  }
</script>

</body>
</html>