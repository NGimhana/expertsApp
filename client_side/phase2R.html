<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Phase 2: Individual Snippet Reasoning</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 40px;
      background-color: #f9f9f9;
    }
    body.dark-mode {
      background-color: #1e1e1e;
      color: #ccc;
    }
    .snippet-box {
      background-color: #2d2d2d;
      color: #ccc;
      padding: 15px;
      border-radius: 8px;
      white-space: pre-wrap;
      font-family: 'Courier New', monospace;
      margin-bottom: 20px;
    }
    .navigation-buttons button, #continue-button, #theme-toggle {
      padding: 10px 20px;
      margin: 10px 10px 10px 0;
      font-size: 16px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    .navigation-buttons button {
      background-color: #4CAF50;
      color: white;
    }
    #continue-button {
      background-color: #2196F3;
      color: white;
    }
    #theme-toggle {
      background-color: #333;
      color: white;
    }
    #theme-toggle:hover {
      background-color: #555;
    }
    textarea {
      width: 100%;
      height: 150px;
      padding: 10px;
      font-size: 14px;
      border-radius: 5px;
      border: 1px solid #bbb;
    }
    label {
      font-weight: bold;
    }
    .instructions {
      margin-bottom: 20px;
      padding: 20px;
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    body.dark-mode .instructions {
      background: #2c2c2c;
      color: #ccc;
    }
  </style>
</head>
<body>
  <h2>Phase 2: Individual Snippet Reasoning</h2>

  <button id="theme-toggle" onclick="toggleTheme()">Toggle Theme</button>

  <label for="participantName">Your Full Name:</label>
  <input type="text" id="participantName" style="width: 300px; padding: 8px; margin-bottom: 20px; border-radius: 5px; border: 1px solid #ccc;" />

  <div class="instructions">
    <p><strong>Instructions:</strong> In this phase, you will view one code snippet at a time. For each snippet, please assess its comprehensibility by describing what makes it easy or hard to understand. Consider aspects like naming, logic clarity, code structure, and use of language constructs. Your responses are saved automatically as you go.</p>
  </div>

  <div id="snippetTitle" style="font-weight: bold; margin-bottom: 10px;"></div>
  <div id="snippetBox" class="snippet-box"></div>

  <label for="reasoningBox">Tell us about how do you assess this snippet's comprehensibility? What features might make it easy to understand? What features make it hard to understand?</label>
  <textarea id="reasoningBox" placeholder="Write your explanation here..."></textarea>

  <div class="navigation-buttons">
    <button onclick="prevSnippet()">⬅️ Previous</button>
    <button onclick="nextSnippet()" id="nextButton">Next ➡️</button>
  </div>

  <button id="continue-button" onclick="goToPhase3()">Continue to Phase 3</button>

  <script>
    const snippets = [
      {
        id: 1,
        title: "Snippet 1",
        code: `public static boolean method1(String name) {\n  if (name == null || name.startsWith(".")) return false;\n  if (name.length() < 1 || name.length() > MAX_NAME_LENGTH) return false;\n  for (int i = 0; i < name.length(); i++) {\n    char c = name.charAt(i);\n    if (!Character.isLetterOrDigit(c) && !VALID_NAME_SET.contains(c)) return false;\n  }\n  return true;\n}`
      },
      {
        id: 2,
        title: "Snippet 2",
        code: `public static boolean method2(URI uri) {\n  if (isFilesystemPath(uri)) return false;\n  String scheme = uri.getScheme();\n  if (scheme == null) return false;\n  switch (scheme) {\n    case "file": case "jar": return false;\n    default: break;\n  }\n  return true;\n}`
      }
    ];

    let currentIndex = 0;
    const reasoningPerSnippet = {};

    window.onload = function() {
      const saved = JSON.parse(sessionStorage.getItem('phase2_state') || '{}');
      if (saved.name) document.getElementById('participantName').value = saved.name;
      if (saved.reasoningMap) Object.assign(reasoningPerSnippet, saved.reasoningMap);
      loadSnippet(currentIndex);
      applySavedTheme();
    };

    function loadSnippet(index) {
      const snippet = snippets[index];
      document.getElementById('snippetTitle').innerText = snippet.title;
      document.getElementById('snippetBox').innerText = snippet.code;
      document.getElementById('reasoningBox').value = reasoningPerSnippet[snippet.id] || '';
      checkNextButton();
    }

    function saveState() {
      const name = document.getElementById('participantName').value.trim();
      const reasoning = document.getElementById('reasoningBox').value.trim();
      reasoningPerSnippet[snippets[currentIndex].id] = reasoning;
      const data = { name, reasoningMap: reasoningPerSnippet };
      sessionStorage.setItem('phase2_state', JSON.stringify(data));
      document.cookie = `phase2_state=${encodeURIComponent(JSON.stringify(data))}; path=/; max-age=${60*60*24*30}`;
      checkNextButton();
    }

    function prevSnippet() {
      saveState();
      if (currentIndex > 0) {
        currentIndex--;
        loadSnippet(currentIndex);
      }
    }

    function nextSnippet() {
      saveState();
      if (document.getElementById('reasoningBox').value.trim() === '') return;
      if (currentIndex < snippets.length - 1) {
        currentIndex++;
        loadSnippet(currentIndex);
      }
    }

    function goToPhase3() {
      saveState();
      location.href = '/phase3.html';
    }

    function toggleTheme() {
      document.body.classList.toggle('dark-mode');
      const isDark = document.body.classList.contains('dark-mode');
      localStorage.setItem('codeTheme', isDark ? 'dark' : 'light');
    }

    function applySavedTheme() {
      const theme = localStorage.getItem('codeTheme') || 'light';
      if (theme === 'dark') document.body.classList.add('dark-mode');
    }

    function checkNextButton() {
      document.getElementById('nextButton').disabled = document.getElementById('reasoningBox').value.trim() === '';
    }

    document.getElementById('reasoningBox').addEventListener('input', saveState);
    document.getElementById('participantName').addEventListener('input', saveState);
  </script>
</body>
</html>